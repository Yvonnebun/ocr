services:
  layout-service:
    build: ./layout_service
    container_name: layout-service
    ports:
      - "8001:8001"
    volumes:
      - ./shared_data:/app/shared_data

  paddle-service:
    build: ./paddle_service
    container_name: paddle-service
    ports:
      - "8002:8002"
    volumes:
      - ./shared_data:/app/shared_data

  ocr-pipeline:
    build: .
    container_name: ocr-pipeline
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - LAYOUT_SERVICE_URL=http://layout-service:8001
      - PADDLE_SERVICE_URL=http://paddle-service:8002
    volumes:
      - ./shared_data:/app/shared_data
      - ./models:/app/models
